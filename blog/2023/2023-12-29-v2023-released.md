---
slug: v2023-release-notes
authors: [ aleafs ]
image: /img/v2023-cover.jpeg
tags: [ Release Notes, v2023 ]
---

# Release Notes (v2023)

2024年来临之际，我很荣幸地代表团队向大家宣布`bluepipe`2023年度版本的诞生。

## 背景

我们花费了几个月的时间构建出`bluepipe`第一个原型版本的时候，团队的成就感斐然。
即便只有一个单机版的程序，在几个早期客户现场验证的时候，也不乏溢美之词，比如**性能炸裂**、**靠谱**、**很智能**等。

但更值得我们关注的，却是客户用起来有点别扭、却没说出来甚至意识不到这是问题的地方。
做产品调研最高效的方法，就是站在背后看用户怎么使用你的产品。

我们通过远程演示、或者辅助用户跑通第一个作业（Aha moment），惭愧地看到，将后台程序的接口，包装成一个个表单直接展现给用户，
是多么地懒惰和缺乏想象力。比如：

* **以任务为操作客体**，用户需要创建一个个任务来完成他的业务目标。这是一种**面向过程**的设计，用户需要非常理解底层的技术细节，才可能在实际使用中得心应手。
* 操作层面，**缺少场景封装**。比如用户需要快速完成某张表从来源库重新同步（数据修复），那么他需要先停止CDC任务，再启动一个跑批的任务，然后再将CDC任务拉起来。步骤繁多且没有辅助校验，极易出错引发业务故障。

出于**以用户为中心，将麻烦留给自己**的团队价值观，我们推出了此次版本更新。

## 主要变化

### 全新交互

* 面向**数据交付**的全新交互，您只需要关注数据表的复制状态，而不用考虑怎么配置任务。

### 流批融合

* 优先使用CDC方式来持续地复制增量数据（需要来源库支持CDC能力）；
* 对同一张数据表而言，基于SQL查询的`批量复制`与基于CDC技术的`流式复制`无缝衔接；
* 一键封装`重刷数据`的功能；确保**应急响应**场景下，无需人工思考流批冲突的问题。

### 游标列

* 支持为每张表单独设置**时间类型**的`游标列`以实现批量复制模式下的**增量同步**能力。

:::caution 限制
`游标列`本质上是一个业务字段，依赖您的应用程序正确地维护它。
因此，如果某行数据被物理删除（DELETE），或者`游标列`没有被正确地更新，都有可能导致基于它的数据同步不能正确工作。

此风险`bluepipe`无法识别，您需要谨慎评估使用此功能。
:::

### 筛选与重命名

* 数据复制到目标库时，支持`表`和`列（字段）`裁剪；
* 数据复制到目标库时，支持`表`和`列（字段）`重命名。

:::tip 提示
表或者列重新进行筛选或者重命名不会影响正在运行或者运行结束的任务，新的配置会在任务下次启动时生效。
您有可能您需要做完相关修改后人工进行数据重刷。
:::

## 连接器

### 新增 ClickZetta 

`ClickZetta`是[云器科技](https://www.yunqi.tech)研发的下一代Single-Engine为核心理念的湖仓平台。

* 支持自动建表（Create Table）和修改表结构（Alter Table）；
* 支持数据实时写入，支持基于`Primary Key`进行数据更新；
* 暂未支持数据读取（含BATCH和CDC）。

:::caution 限制
受`ClickZetta`当前版本限制，对于含 `Primary Key`的表，目前仅支持单线程写入。`bluepipe`自动进行了适配，无`Primary Key`
的表仍然可以多线程大吞吐写入。
:::

### 新增 InterSystems

`InterSystems`是一家提供数据管理和医疗信息系统的公司，为医疗健康、金融服务、供应链和物流等行业提供数据解决方案。
`InterSystems`在2022 Gartner:copyright: 云数据库管理系统魔力象限:tm:中被评为“远见者（Visionary）”。

* 兼容[`InterSystems IRIS`](https://www.intersystems.com/data-platform/) 和[`InterSystems Caché`](https://www.intersystems.com/cache/)两套引擎；
* 支持通过批量方式读取数据；
* 暂未支持基于日志订阅的 CDC 能力；
* 暂未支持数据写入能力。

### 优化 Apache Hive

* 接入时支持[`Zookeeper Service Discovery`](https://cwiki.apache.org/confluence/display/hive/hiveserver2+clients#HiveServer2Clients-ConnectionURLWhenZooKeeperServiceDiscoveryIsEnabled)配置；
* CDC数据以`APPEND`模式写入临时表，定期`MERGE`到主表。

## 遗留问题

### 错误率控制

复制过程中的`错误率控制`尚未支持。
因此，在当前版本中，如果某行数据因为字段类型不兼容、或者字符超长等原因而无法写入，则会导致整个任务失败。

### CDC模式下表之间的耦合

由于CDC技术的特殊性，出于数据库资源考虑，我们限制了一个作业最多启用一条CDC流来复制数据，这必然导致不同表之间互相耦合。
即某张表无法写入，或者写入性能变慢，会导致同一个作业内其他表的复制也被阻塞。

考虑解决此问题而带来的技术复杂度急剧上升，短期内我们不会着手去解决。您可基于业务优先级，将一个作业拆分成多个作业来规避这一问题。
