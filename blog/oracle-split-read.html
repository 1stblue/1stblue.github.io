<!doctype html>
<html lang="zh-Hans" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.0">
<title data-rh="true">Oracle大表的并行读取 | 1stblue.com</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://1stblue.github.io/blog/oracle-split-read"><meta data-rh="true" name="docusaurus_locale" content="zh-Hans"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="zh-Hans"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" name="keywords" content="react-admin, react-framework, internal-tool, admin-panel, ant-design, material ui, mui"><meta data-rh="true" property="og:title" content="Oracle大表的并行读取 | 1stblue.com"><meta data-rh="true" name="description" content="测试环境"><meta data-rh="true" property="og:description" content="测试环境"><meta data-rh="true" property="og:image" content="http://www.oracle.com/node/oce/storyhub/prod/api/v1.1/assets/CONT2211A10520EB41FBA9E95AA892CCEE34/native/rh08-oracle-for-azure-732x372.jpg"><meta data-rh="true" name="twitter:image" content="http://www.oracle.com/node/oce/storyhub/prod/api/v1.1/assets/CONT2211A10520EB41FBA9E95AA892CCEE34/native/rh08-oracle-for-azure-732x372.jpg"><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2023-10-11T00:00:00.000Z"><meta data-rh="true" property="article:author" content="https://github.com/aleafs"><meta data-rh="true" property="article:tag" content="Oracle,ROWID,并行"><link data-rh="true" rel="icon" href="/img/favicon.png"><link data-rh="true" rel="canonical" href="https://1stblue.github.io/blog/oracle-split-read"><link data-rh="true" rel="alternate" href="https://1stblue.github.io/blog/oracle-split-read" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://1stblue.github.io/blog/oracle-split-read" hreflang="x-default"><link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-27Z1WY952H"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-27Z1WY952H",{})</script>




<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="1stblue.com RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="1stblue.com Atom Feed">
<link rel="alternate" type="application/json" href="/blog/feed.json" title="1stblue.com JSON Feed"><link rel="stylesheet" href="/assets/css/styles.078a895e.css">
<link rel="preload" href="/assets/js/runtime~main.64120d5e.js" as="script">
<link rel="preload" href="/assets/js/main.f98f36aa.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">跳到主要内容</a></div><div class="main-wrapper min-h-[100dvh] flex flex-col bg-gray-0 transition-colors duration-150 ease-in-out"><header class="sticky top-0 z-10"><div class="absolute top-0 left-0 right-0 backdrop-blur-[6px] landing-md:backdrop-blur-[12px] z-[-1] bg-gray-0 bg-opacity-80 pointer-events-none transition-colors duration-150 ease-in-out" style="top:-20px;bottom:-80px;-webkit-mask-image:linear-gradient(to bottom, transparent 0, transparent calc(0% + 20px), black calc(0% + 20px), black calc(100% - 80px), transparent calc(100% - 80px));mask-image:linear-gradient(to bottom, transparent 0, transparent calc(0% + 20px), black calc(0% + 20px), black calc(100% - 80px), transparent calc(100% - 80px))"></div><div class="relative z-[1] p-4 landing-sm:px-8 landing-md:py-5"><div class="flex items-center justify-between max-w-[83%]"><div class="w-[130px] landing-lg:w-[200px]"><a class="flex items-center font-semibold no-underline text-gray-900" href="/"><svg width="40" height="40" viewBox="0 0 201 201" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M100.774 16.656C54.3819 16.656 16.7739 54.264 16.7739 100.656C16.7739 147.048 54.3819 184.656 100.774 184.656C147.166 184.656 184.774 147.048 184.774 100.656C184.774 54.264 147.166 16.656 100.774 16.656ZM137.93 93.266L127.584 108.041L110.498 132.442H136.082L102.962 143.204L61.5629 156.656V156.652L78.5129 132.443H78.517L95.5989 108.042H63.619L73.9689 93.267L91.0549 68.866H65.4709L98.5909 58.105L139.986 44.657L123.036 68.866H123.032L105.95 93.267H137.931L137.93 93.266Z" fill="url(#paint0_linear_22_656)"></path><defs><linearGradient id="paint0_linear_22_656" x1="16.7739" y1="100.656" x2="184.774" y2="100.656" gradientUnits="userSpaceOnUse"><stop stop-color="#19DEF8"></stop><stop offset="0.142" stop-color="#14C0F5"></stop><stop offset="0.431" stop-color="#0B8AF1"></stop><stop offset="0.681" stop-color="#0562EE"></stop><stop offset="0.879" stop-color="#0149EC"></stop><stop offset="1" stop-color="#0041EC"></stop></linearGradient></defs></svg>    Bluepipe</a></div><button type="button" class="text-gray-900 block landing-md:hidden"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32" fill="none"><path fill="currentColor" d="M4 10a1 1 0 0 1 1-1h22a1 1 0 1 1 0 2H5a1 1 0 0 1-1-1ZM4 16a1 1 0 0 1 1-1h22a1 1 0 1 1 0 2H5a1 1 0 0 1-1-1ZM5 21a1 1 0 1 0 0 2h22a1 1 0 1 0 0-2H5Z"></path></svg></button><div class="hidden landing-md:flex flex-1 items-center gap-8"><div id="popover-产品" class="relative inline-flex items-center" data-headlessui-state=""><button class="inline-flex items-center text-sm leading-6 font-normal" type="button" aria-expanded="false" data-headlessui-state=""><span class="text-gray-900 transition-colors duration-150 ease-in-out inline-block hover:text-bluepipe-blue">产品</span><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" aria-hidden="true" class="transition duration-150 ease-out -mr-2 text-sm leading-6 text-gray-500"><path fill="currentColor" fill-rule="evenodd" d="M15.707 9.793a1 1 0 0 0-1.414 0L12 12.086 9.707 9.793a1 1 0 0 0-1.414 1.414l3 3a1 1 0 0 0 1.414 0l3-3a1 1 0 0 0 0-1.414Z" clip-rule="evenodd"></path></svg></button></div><div style="position:fixed;top:1px;left:1px;width:1px;height:0;padding:0;margin:-1px;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border-width:0;display:none"></div><a class="inline-flex items-center gap-2 text-sm leading-6 font-normal text-gray-900 transition-colors duration-150 ease-in-out no-underline hover:text-bluepipe-blue hover:text-gray-900" href="/docs">文档</a><a class="inline-flex items-center gap-2 text-sm leading-6 font-normal text-gray-900 transition-colors duration-150 ease-in-out no-underline hover:text-bluepipe-blue hover:text-gray-900" href="/blog">博客</a><a class="inline-flex items-center gap-2 text-sm leading-6 font-normal text-gray-900 transition-colors duration-150 ease-in-out no-underline hover:text-bluepipe-blue hover:text-gray-900" href="/connectors">连接器</a><a class="inline-flex items-center gap-2 text-sm leading-6 font-normal text-gray-900 transition-colors duration-150 ease-in-out no-underline hover:text-bluepipe-blue hover:text-gray-900" href="/tests">测试集</a></div><div class="hidden landing-md:flex items-center justify-end gap-4 w-[130px] landing-lg:w-[200px]"></div></div></div><div class="w-full h-0.5 translate"><div class="h-full bg-bluepipe-blue" style="width:0%"></div></div></header><div class="flex justify-center mx-auto max-w-screen-blog-max w-full"><div class="bluepipe-prose flex-1 min-w-0 xl:px-8"><article class="py-10 px-4 sm:px-0 blog-sm:py-12 blog-md:py-16 w-full mx-auto max-w-[512px] blog-sm:max-w-screen-blog-sm blog-lg:max-w-screen-content-2xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><meta itemprop="image" content="http://www.oracle.com/node/oce/storyhub/prod/api/v1.1/assets/CONT2211A10520EB41FBA9E95AA892CCEE34/native/rh08-oracle-for-azure-732x372.jpg"><div class="blog-sm:px-6"><div class="mb-6 text-sm"><div class="flex justify-between sm:flex-row flex-col"><div class="flex justify-center items-center gap-2"></div><div class="flex items-center gap-2 text-gray-600"><time datetime="2023-10-11T00:00:00.000Z" itemprop="datePublished">2023年10月11日</time><span class="w-[4px] h-[4px] rounded-full bg-gray-600"></span>阅读需 3 分钟</div></div></div><h1 class="text-xl md:text-4xl" itemprop="headline">Oracle大表的并行读取</h1><div id="post-content" class="markdown" itemprop="articleBody"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="测试环境">测试环境<a href="#测试环境" class="hash-link" aria-label="测试环境的直接链接" title="测试环境的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="硬件">硬件<a href="#硬件" class="hash-link" aria-label="硬件的直接链接" title="硬件的直接链接">​</a></h3><h3 class="anchor anchorWithStickyNavbar_LWe7" id="数据">数据<a href="#数据" class="hash-link" aria-label="数据的直接链接" title="数据的直接链接">​</a></h3><p><strong>表结构</strong></p><div class="language-oraclesqlplus rounded-md bg-gray-50 border mb-6 relative"><div class="py-3 px-4 text-[13px] leading-5 text-gray-600 border-b font-mono flex items-center gap-2">create-table.sql</div><div class="relative pt-3 pb-0 not-prose"><pre tabindex="0" class="prism-code language-oraclesqlplus bg-transparent !mt-0 !mb-0 m-0 px-0 pt-0 font-mono pb-3"><code class="bg-transparent inline-block min-w-full"><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#403f53"><span class="token plain">CREATE TABLE TPCH.FP_RAW_DATA</span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#403f53"><span class="token plain">(</span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#403f53"><span class="token plain">    CP_IDX   number(20, 0)    not null,</span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#403f53"><span class="token plain">    WAFERID  varchar(10)      not null,</span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#403f53"><span class="token plain">    BIN      number(10, 0)    not null,</span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#403f53"><span class="token plain">    SITE     DOUBLE PRECISION,</span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#403f53"><span class="token plain">    X        DOUBLE PRECISION not null,</span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#403f53"><span class="token plain">    Y        DOUBLE PRECISION not null,</span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#403f53"><span class="token plain">    BIN_1    DOUBLE PRECISION not null,</span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#403f53"><span class="token plain">    BIN_2    DOUBLE PRECISION,</span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#403f53"><span class="token plain">    BIN_3    DOUBLE PRECISION,</span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#403f53"><span class="token plain">    -- BIN_4 ~ BIN_39 DOUBLE PRECISION</span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#403f53"><span class="token plain">    BIN_40   DOUBLE PRECISION,</span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#403f53"><span class="token plain">    BIN_CODE VARCHAR(10)</span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#403f53"><span class="token plain">);</span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#403f53"><span class="token plain">CREATE UNIQUE INDEX TPCH.FP_RAW_IDX2 ON TPCH.FP_RAW_DATA (CP_IDX, WAFERID, X, Y);</span><br></span></code></pre></div><div class="absolute right-3 top-1.5 flex items-center gap-2"><button type="button" aria-label="Copy code to clipboard" title="Copy code to clipboard" class="w-8 h-8 flex justify-center items-center bg-gray-50 hover:bg-gray-100 rounded group transition-[background-color] duration-200 ease-in-out"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="none" class="w-4 h-4 text-gray-400 transition-all duration-200 ease-in-out"><path fill="currentColor" d="M0 3a3 3 0 0 1 3-3h8a1 1 0 1 1 0 2H3a1 1 0 0 0-1 1v8a1 1 0 1 1-2 0V3Z"></path><path fill="currentColor" fill-rule="evenodd" d="M4 6a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6Zm10 0H6v8h8V6Z" clip-rule="evenodd"></path></svg></button></div></div><p><strong>准备20,000万（2亿）行数据</strong></p><div class="language-oraclesqlplus rounded-md bg-gray-50 border mb-6 relative"><div class="relative pt-3 pb-0 not-prose"><pre tabindex="0" class="prism-code language-oraclesqlplus bg-transparent !mt-0 !mb-0 m-0 px-0 pt-0 font-mono pb-3"><code class="bg-transparent inline-block min-w-full"><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#403f53"><span class="token plain">SELECT TABLE_NAME</span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#403f53"><span class="token plain">     , NUM_ROWS</span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#403f53"><span class="token plain">     , AVG_ROW_LEN</span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#403f53"><span class="token plain">     , ROUND(AVG_ROW_LEN * NUM_ROWS / 1024 / 1024 / 1024, 2) AS GB</span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#403f53"><span class="token plain">FROM ALL_TABLES</span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#403f53"><span class="token plain">where OWNER = &#x27;TPCH&#x27;</span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#403f53"><span class="token plain">  AND TABLE_NAME = &#x27;FP_RAW_DATA_MARS3&#x27;</span><br></span></code></pre></div><div class="absolute right-3 top-[9px] flex items-center gap-2"><button type="button" aria-label="Copy code to clipboard" title="Copy code to clipboard" class="w-8 h-8 flex justify-center items-center bg-gray-50 hover:bg-gray-100 rounded group transition-[background-color] duration-200 ease-in-out"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="none" class="w-4 h-4 text-gray-400 transition-all duration-200 ease-in-out"><path fill="currentColor" d="M0 3a3 3 0 0 1 3-3h8a1 1 0 1 1 0 2H3a1 1 0 0 0-1 1v8a1 1 0 1 1-2 0V3Z"></path><path fill="currentColor" fill-rule="evenodd" d="M4 6a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6Zm10 0H6v8h8V6Z" clip-rule="evenodd"></path></svg></button></div></div><div class="language-shell rounded-md bg-gray-50 border mb-6 relative"><div class="relative pt-3 pb-0 not-prose"><pre tabindex="0" class="prism-code language-shell bg-transparent !mt-0 !mb-0 m-0 px-0 pt-0 font-mono pb-3"><code class="bg-transparent inline-block min-w-full"><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#403f53"><span class="token plain">TABLE_NAME</span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#403f53"><span class="token plain">--------------------------------------------------------------------------------</span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#403f53"><span class="token plain">  NUM_ROWS AVG_ROW_LEN         GB</span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#403f53"><span class="token plain">---------- ----------- ----------</span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#403f53"><span class="token plain">FP_RAW_DATA_MARS3</span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#403f53"><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">200000000</span><span class="token plain">      </span><span class="token number" style="color:rgb(170, 9, 130)">99</span><span class="token plain">      </span><span class="token number" style="color:rgb(170, 9, 130)">18.44</span><br></span></code></pre></div><div class="absolute right-3 top-[9px] flex items-center gap-2"><button type="button" aria-label="Copy code to clipboard" title="Copy code to clipboard" class="w-8 h-8 flex justify-center items-center bg-gray-50 hover:bg-gray-100 rounded group transition-[background-color] duration-200 ease-in-out"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="none" class="w-4 h-4 text-gray-400 transition-all duration-200 ease-in-out"><path fill="currentColor" d="M0 3a3 3 0 0 1 3-3h8a1 1 0 1 1 0 2H3a1 1 0 0 0-1 1v8a1 1 0 1 1-2 0V3Z"></path><path fill="currentColor" fill-rule="evenodd" d="M4 6a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6Zm10 0H6v8h8V6Z" clip-rule="evenodd"></path></svg></button></div></div><p>分16个分片进行，平均每个分片处理12,500,000（1250万）行数据</p><p>脚注<sup id="fnref-1-784864"><a href="#fn-1-784864" class="footnote-ref" rel="noopener dofollow">1</a></sup></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="测试验证">测试验证<a href="#测试验证" class="hash-link" aria-label="测试验证的直接链接" title="测试验证的直接链接">​</a></h2><table><thead><tr><th align="center">编号</th><th align="left">切分字段</th><th align="left">切分方法</th></tr></thead><tbody><tr><td align="center">A</td><td align="left">CP_IDX</td><td align="left">Range: (Minimum, Maximum)</td></tr><tr><td align="center">B</td><td align="left">ROWID</td><td align="left">Range: (Minimum, Maximum)</td></tr><tr><td align="center">C</td><td align="left">ROWID</td><td align="left">Range: Scan</td></tr><tr><td align="center">D</td><td align="left">ROWID</td><td align="left">Range: DBMS_PARALLEL_EXECUTE.create_chunks_by_rowid</td></tr><tr><td align="center">E</td><td align="left">ROWID</td><td align="left">Hash</td></tr></tbody></table><h3 class="anchor anchorWithStickyNavbar_LWe7" id="a-基于主键索引列按照min-max区间切分">A: 基于主键/索引列，按照(min, max)区间切分<a href="#a-基于主键索引列按照min-max区间切分" class="hash-link" aria-label="A: 基于主键/索引列，按照(min, max)区间切分的直接链接" title="A: 基于主键/索引列，按照(min, max)区间切分的直接链接">​</a></h3><div class="language-oraclesqlplus rounded-md bg-gray-50 border mb-6 relative"><div class="relative pt-3 pb-0 not-prose"><pre tabindex="0" class="prism-code language-oraclesqlplus bg-transparent !mt-0 !mb-0 m-0 px-0 pt-0 font-mono pb-3"><code class="bg-transparent inline-block min-w-full"><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#403f53"><span class="token plain">SELECT /*+parallel(4)*/</span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#403f53"><span class="token plain">    COUNT(1)       AS total</span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#403f53"><span class="token plain">     , MIN(CP_IDX) AS lower</span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#403f53"><span class="token plain">     , MAX(CP_IDX) AS upper</span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#403f53"><span class="token plain">FROM TPCH.FP_RAW_DATA;</span><br></span></code></pre></div><div class="absolute right-3 top-[9px] flex items-center gap-2"><button type="button" aria-label="Copy code to clipboard" title="Copy code to clipboard" class="w-8 h-8 flex justify-center items-center bg-gray-50 hover:bg-gray-100 rounded group transition-[background-color] duration-200 ease-in-out"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="none" class="w-4 h-4 text-gray-400 transition-all duration-200 ease-in-out"><path fill="currentColor" d="M0 3a3 3 0 0 1 3-3h8a1 1 0 1 1 0 2H3a1 1 0 0 0-1 1v8a1 1 0 1 1-2 0V3Z"></path><path fill="currentColor" fill-rule="evenodd" d="M4 6a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6Zm10 0H6v8h8V6Z" clip-rule="evenodd"></path></svg></button></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="b-基于rowid按照min-max区间切分">B: 基于ROWID，按照(min, max)区间切分<a href="#b-基于rowid按照min-max区间切分" class="hash-link" aria-label="B: 基于ROWID，按照(min, max)区间切分的直接链接" title="B: 基于ROWID，按照(min, max)区间切分的直接链接">​</a></h3><div class="language-oraclesqlplus rounded-md bg-gray-50 border mb-6 relative"><div class="relative pt-3 pb-0 not-prose"><pre tabindex="0" class="prism-code language-oraclesqlplus bg-transparent !mt-0 !mb-0 m-0 px-0 pt-0 font-mono pb-3"><code class="bg-transparent inline-block min-w-full"><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#403f53"><span class="token plain">SELECT /*+parallel(4)*/</span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#403f53"><span class="token plain">    COUNT(1)      AS total</span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#403f53"><span class="token plain">     , MIN(ROWID) AS lower</span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#403f53"><span class="token plain">     , MAX(ROWID) AS upper</span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#403f53"><span class="token plain">FROM TPCH.FP_RAW_DATA;</span><br></span></code></pre></div><div class="absolute right-3 top-[9px] flex items-center gap-2"><button type="button" aria-label="Copy code to clipboard" title="Copy code to clipboard" class="w-8 h-8 flex justify-center items-center bg-gray-50 hover:bg-gray-100 rounded group transition-[background-color] duration-200 ease-in-out"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="none" class="w-4 h-4 text-gray-400 transition-all duration-200 ease-in-out"><path fill="currentColor" d="M0 3a3 3 0 0 1 3-3h8a1 1 0 1 1 0 2H3a1 1 0 0 0-1 1v8a1 1 0 1 1-2 0V3Z"></path><path fill="currentColor" fill-rule="evenodd" d="M4 6a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6Zm10 0H6v8h8V6Z" clip-rule="evenodd"></path></svg></button></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="c-基于rowidscan-split-by-rows">C: 基于ROWID，Scan, split by rows<a href="#c-基于rowidscan-split-by-rows" class="hash-link" aria-label="C: 基于ROWID，Scan, split by rows的直接链接" title="C: 基于ROWID，Scan, split by rows的直接链接">​</a></h3><div class="language-oraclesqlplus rounded-md bg-gray-50 border mb-6 relative"><div class="relative pt-3 pb-0 not-prose"><pre tabindex="0" class="prism-code language-oraclesqlplus bg-transparent !mt-0 !mb-0 m-0 px-0 pt-0 font-mono pb-3"><code class="bg-transparent inline-block min-w-full"><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#403f53"><span class="token plain">SELECT /*+parallel(4)*/ id</span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#403f53"><span class="token plain">FROM (SELECT id, ROWNUM AS rn</span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#403f53"><span class="token plain">      FROM (SELECT ROWID AS id</span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#403f53"><span class="token plain">            FROM TPCH.FP_RAW_DATA</span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#403f53"><span class="token plain">            ORDER BY ROWID) t) x</span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#403f53"><span class="token plain">WHERE MOD(rn, 12500000) = 0</span><br></span></code></pre></div><div class="absolute right-3 top-[9px] flex items-center gap-2"><button type="button" aria-label="Copy code to clipboard" title="Copy code to clipboard" class="w-8 h-8 flex justify-center items-center bg-gray-50 hover:bg-gray-100 rounded group transition-[background-color] duration-200 ease-in-out"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="none" class="w-4 h-4 text-gray-400 transition-all duration-200 ease-in-out"><path fill="currentColor" d="M0 3a3 3 0 0 1 3-3h8a1 1 0 1 1 0 2H3a1 1 0 0 0-1 1v8a1 1 0 1 1-2 0V3Z"></path><path fill="currentColor" fill-rule="evenodd" d="M4 6a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6Zm10 0H6v8h8V6Z" clip-rule="evenodd"></path></svg></button></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="d-dbms_parallel_execute包create_chunks_by_rowid">D: <code>DBMS_PARALLEL_EXECUTE</code>包<code>create_chunks_by_rowid</code><a href="#d-dbms_parallel_execute包create_chunks_by_rowid" class="hash-link" aria-label="d-dbms_parallel_execute包create_chunks_by_rowid的直接链接" title="d-dbms_parallel_execute包create_chunks_by_rowid的直接链接">​</a></h3><div class="language-oraclesqlplus rounded-md bg-gray-50 border mb-6 relative"><div class="relative pt-3 pb-0 not-prose"><pre tabindex="0" class="prism-code language-oraclesqlplus bg-transparent !mt-0 !mb-0 m-0 px-0 pt-0 font-mono pb-3"><code class="bg-transparent inline-block min-w-full"><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#403f53"><span class="token plain">BEGIN</span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#403f53"><span class="token plain">    DBMS_PARALLEL_EXECUTE.create_task(task_name =&gt; &#x27;tpch_test&#x27;);</span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#403f53"><span class="token plain">    DBMS_PARALLEL_EXECUTE.create_chunks_by_rowid(</span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#403f53"><span class="token plain">            task_name =&gt; &#x27;tpch_test&#x27;,</span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#403f53"><span class="token plain">            table_owner =&gt; &#x27;TPCH&#x27;,</span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#403f53"><span class="token plain">            table_name =&gt; &#x27;FP_RAW_DATA&#x27;,</span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#403f53"><span class="token plain">            by_row =&gt; TRUE,</span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#403f53"><span class="token plain">            chunk_size =&gt; 12500000);</span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#403f53"><span class="token plain">END;</span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#403f53"><span class="token plain">/</span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#403f53"><span class="token plain">SELECT chunk_id, status, start_rowid, end_rowid</span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#403f53"><span class="token plain">FROM user_parallel_execute_chunks</span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#403f53"><span class="token plain">WHERE task_name = &#x27;tpch_test&#x27;</span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#403f53"><span class="token plain">ORDER BY chunk_id;</span><br></span></code></pre></div><div class="absolute right-3 top-[9px] flex items-center gap-2"><button type="button" aria-label="Copy code to clipboard" title="Copy code to clipboard" class="w-8 h-8 flex justify-center items-center bg-gray-50 hover:bg-gray-100 rounded group transition-[background-color] duration-200 ease-in-out"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="none" class="w-4 h-4 text-gray-400 transition-all duration-200 ease-in-out"><path fill="currentColor" d="M0 3a3 3 0 0 1 3-3h8a1 1 0 1 1 0 2H3a1 1 0 0 0-1 1v8a1 1 0 1 1-2 0V3Z"></path><path fill="currentColor" fill-rule="evenodd" d="M4 6a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6Zm10 0H6v8h8V6Z" clip-rule="evenodd"></path></svg></button></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="e-基于rowidhash切分">E: 基于ROWID，Hash切分<a href="#e-基于rowidhash切分" class="hash-link" aria-label="E: 基于ROWID，Hash切分的直接链接" title="E: 基于ROWID，Hash切分的直接链接">​</a></h3><div class="language-oraclesqlplus rounded-md bg-gray-50 border mb-6 relative"><div class="py-3 px-4 text-[13px] leading-5 text-gray-600 border-b font-mono flex items-center gap-2">hello.sql</div><div class="relative pt-3 pb-0 not-prose"><pre tabindex="0" class="prism-code language-oraclesqlplus bg-transparent !mt-0 !mb-0 m-0 px-0 pt-0 font-mono pb-3"><code class="bg-transparent inline-block min-w-full"><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#403f53"><span class="token plain">SELECT *</span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#403f53"><span class="token plain">FROM TPCH.FP_RAW_DATA</span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#403f53"><span class="token plain">WHERE MOD(DBMS_ROWID.ROWID_ROW_NUMBER(TPCH.FP_RAW_DATA.ROWID), 16) = 0</span><br></span></code></pre></div><div class="absolute right-3 top-1.5 flex items-center gap-2"><button type="button" aria-label="Copy code to clipboard" title="Copy code to clipboard" class="w-8 h-8 flex justify-center items-center bg-gray-50 hover:bg-gray-100 rounded group transition-[background-color] duration-200 ease-in-out"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="none" class="w-4 h-4 text-gray-400 transition-all duration-200 ease-in-out"><path fill="currentColor" d="M0 3a3 3 0 0 1 3-3h8a1 1 0 1 1 0 2H3a1 1 0 0 0-1 1v8a1 1 0 1 1-2 0V3Z"></path><path fill="currentColor" fill-rule="evenodd" d="M4 6a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6Zm10 0H6v8h8V6Z" clip-rule="evenodd"></path></svg></button></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="结论">结论<a href="#结论" class="hash-link" aria-label="结论的直接链接" title="结论的直接链接">​</a></h2><div class="rounded-lg admonition admonition-tip mb-6 bg-bluepipe-green bg-opacity-10 border-l-bluepipe-green"><div class="border-l-4 border-l-solid border-l-inherit rounded-tl-lg rounded-bl-lg p-4 flex flex-col gap-2 sm:gap-4"><div class="flex items-center gap-2 text-xs sm:text-base 2xl:text-base 2xl:leading-7 font-semibold text-bluepipe-green"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"><path fill="currentColor" fill-rule="evenodd" d="M18 10c0 2.22-1.206 4.16-3 5.197V16a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-1v-.803A6 6 0 1 1 18 10Zm-7.414-1.414a1 1 0 0 0-1.414-1.414A3.99 3.99 0 0 0 8 10a3.99 3.99 0 0 0 1.172 2.828 1 1 0 0 0 1.414-1.414A1.99 1.99 0 0 1 10 10c0-.553.223-1.051.586-1.414Z" clip-rule="evenodd"></path><path fill="currentColor" d="M11 18a1 1 0 0 0 0 2h2a1 1 0 0 0 0-2h-2Z"></path></svg><span class="uppercase">TIP</span></div><div class="text-gray-0 text-base last:mb-0"><p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque elementum dignissim ultricies. Fusce rhoncus ipsum
tempor eros aliquam consequat. Lorem ipsum dolor sit amet</p></div></div></div><ol><li>在我们的场景中，允许<code>Partitioned Table</code>?</li><li>优先使用 <code>DBMS_PARALLEL_EXECUTE</code>包中的<code>create_chunks_by_rowid</code>方法，获取基于<code>ROWID</code>切分；</li><li>如果因为版本兼容性或者权限等原因导致1失败，则尝试采用；</li><li>啦啦啦</li></ol><div class="footnotes"><hr><ol><li id="fn-1-784864"><a href="https://docs.oracle.com/en/database/oracle/oracle-database/19/arpls/DBMS_PARALLEL_EXECUTE.html" target="_blank" rel="noopener noreferrer nofollow">Oracle DBMS_PARALLEL_EXECUTE</a><a href="#fnref-1-784864" class="footnote-backref" rel="noopener dofollow">↩</a></li></ol></div></div></div></article></div><div class="w-[280px] hidden blog-md:block flex-shrink-0"><div class="hidden blog-md:block w-full sticky right-0 top-[80px] max-w-[280px] overflow-auto h-[calc(100vh-80px)] px-3 blog-md:py-16 border-l border-l-gray-100"><div class="flex flex-wrap gap-2 pb-6 pl-1"><a class="text-xs bg-gray-100 text-gray-600 rounded py-1 px-2 no-underline hover:no-underline whitespace-nowrap" href="/blog/tags/oracle">Oracle</a><a class="text-xs bg-gray-100 text-gray-600 rounded py-1 px-2 no-underline hover:no-underline whitespace-nowrap" href="/blog/tags/rowid">ROWID</a><a class="text-xs bg-gray-100 text-gray-600 rounded py-1 px-2 no-underline hover:no-underline whitespace-nowrap" href="/blog/tags/并行">并行</a></div><ul class="list-none m-0 p-0"><li><a href="#测试环境" class="bluepipe-toc-item pl-3 py-2 pr-3 hover:text-gray-900 text-gray-500 rounded-lg transition-colors duration-200 ease-in-out block text-sm leading-6 no-underline hover:no-underline">测试环境</a></li><li><a href="#硬件" class="bluepipe-toc-item pl-7 py-2 pr-3 hover:text-gray-900 text-gray-500 rounded-lg transition-colors duration-200 ease-in-out block text-sm leading-6 no-underline hover:no-underline">硬件</a></li><li><a href="#数据" class="bluepipe-toc-item pl-7 py-2 pr-3 hover:text-gray-900 text-gray-500 rounded-lg transition-colors duration-200 ease-in-out block text-sm leading-6 no-underline hover:no-underline">数据</a></li><li><a href="#测试验证" class="bluepipe-toc-item pl-3 py-2 pr-3 hover:text-gray-900 text-gray-500 rounded-lg transition-colors duration-200 ease-in-out block text-sm leading-6 no-underline hover:no-underline">测试验证</a></li><li><a href="#a-基于主键索引列按照min-max区间切分" class="bluepipe-toc-item pl-7 py-2 pr-3 hover:text-gray-900 text-gray-500 rounded-lg transition-colors duration-200 ease-in-out block text-sm leading-6 no-underline hover:no-underline">A: 基于主键/索引列，按照(min, max)区间切分</a></li><li><a href="#b-基于rowid按照min-max区间切分" class="bluepipe-toc-item pl-7 py-2 pr-3 hover:text-gray-900 text-gray-500 rounded-lg transition-colors duration-200 ease-in-out block text-sm leading-6 no-underline hover:no-underline">B: 基于ROWID，按照(min, max)区间切分</a></li><li><a href="#c-基于rowidscan-split-by-rows" class="bluepipe-toc-item pl-7 py-2 pr-3 hover:text-gray-900 text-gray-500 rounded-lg transition-colors duration-200 ease-in-out block text-sm leading-6 no-underline hover:no-underline">C: 基于ROWID，Scan, split by rows</a></li><li><a href="#d-dbms_parallel_execute包create_chunks_by_rowid" class="bluepipe-toc-item pl-7 py-2 pr-3 hover:text-gray-900 text-gray-500 rounded-lg transition-colors duration-200 ease-in-out block text-sm leading-6 no-underline hover:no-underline">D: <code>DBMS_PARALLEL_EXECUTE</code>包<code>create_chunks_by_rowid</code></a></li><li><a href="#e-基于rowidhash切分" class="bluepipe-toc-item pl-7 py-2 pr-3 hover:text-gray-900 text-gray-500 rounded-lg transition-colors duration-200 ease-in-out block text-sm leading-6 no-underline hover:no-underline">E: 基于ROWID，Hash切分</a></li><li><a href="#结论" class="bluepipe-toc-item pl-3 py-2 pr-3 hover:text-gray-900 text-gray-500 rounded-lg transition-colors duration-200 ease-in-out block text-sm leading-6 no-underline hover:no-underline">结论</a></li></ul></div></div></div><footer class="w-full"><div class="border-t border-t-solid border-t-gray-100"><div class="grid grid-cols-1 max-w-screen-landing-md landing-lg:max-w-screen-landing-lg mx-auto"><div class="px-4 landing-sm:px-8 landing-lg:px-12 py-6 landing-lg:pt-8 landing-lg:pb-12 flex flex-row flex-wrap items-start justify-start gap-6"><div class="hidden landing-lg:flex max-w-[282px] w-full"><div class="py-6 landing-lg:py-0 flex flex-col gap-4 landing-lg:max-w-[224px]"><div class="font-semibold text-sm leading-6 text-gray-900">关于萃蓝</div><div class="font-normal text-sm leading-5 text-gray-600"></div></div></div><div class="flex flex-col gap-4 min-w-[152px]"><div class="text-sm leading-6 font-semibold text-gray-900">用户协议</div><div class="flex flex-col gap-2"><a href="http://www.12348.gov.cn/" target="_blank" rel="noopener noreferrer" class="text-sm leading-5 hover:no-underline text-gray-600 hover:text-gray-800">用户协议</a></div></div><div class="flex flex-col gap-4 min-w-[152px]"><div class="text-sm leading-6 font-semibold text-gray-900">隐私政策</div><div class="flex flex-col gap-2"><a href="/privacy-policy" class="text-sm leading-5 hover:no-underline text-gray-600 hover:text-gray-800">隐私协议</a></div></div><div class="flex flex-col gap-4 min-w-[152px]"><div class="text-sm leading-6 font-semibold text-gray-900">网站备案</div><div class="flex flex-col gap-2"><a href="http://www.12348.gov.cn/" target="_blank" rel="noopener noreferrer" class="text-sm leading-5 hover:no-underline text-gray-600 hover:text-gray-800">隐私协议</a></div></div></div><div class="px-4 landing-sm:px-8 grid grid-cols-1 landing-sm:grid-cols-2 landing-sm:gap-8 landing-lg:hidden"><div class="py-6 landing-lg:py-0 flex flex-col gap-4 landing-lg:max-w-[224px]"><div class="font-semibold text-sm leading-6 text-gray-900">关于萃蓝</div><div class="font-normal text-sm leading-5 text-gray-600"></div></div></div></div></div><div class="border-t border-t-solid border-t-gray-100 bg-gray-50"><div class="py-6 landing-sm:py-8 landing-lg:py-6 px-4 landing-sm:px-8 landing-lg:px-12 grid grid-cols-1 landing-md:grid-cols-2 gap-8 max-w-screen-landing-md landing-lg:max-w-screen-landing-lg mx-auto"><div class="flex flex-col landing-sm:flex-row gap-4 items-start justify-start"></div><div class="text-left landing-md:text-right text-sm pr-6 landing-sm:pr-0 leading-5 text-gray-900 font-normal">© 2023, 1stblue.com.</div></div></div></footer></div></div>
<script src="/assets/js/runtime~main.64120d5e.js"></script>
<script src="/assets/js/main.f98f36aa.js"></script>
</body>
</html>